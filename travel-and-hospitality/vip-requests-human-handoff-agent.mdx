# Build Your VIP Requests Escalation & Human Handoff Agent with Mastra

> Create a Mastra escalation agent that classifies luxury / high-value client requests, assigns service level (concierge → senior-concierge → vip-manager → human), prioritizes urgency, and supports human handoff — then connect it to CometChat.

***

## What You’ll Build

- **Mastra escalation agent** (`vipRequestsAgent`) for luxury service triage.
- Multi-level specialist agents (concierge tiers + human rep) (present/extendable in `agents/`).
- Priority & routing logic (standard, high, urgent, critical) with escalation footer.
- Workflow (`vip-request-workflow`) & tool (`vip-request-tool`) for structured routing decisions.
- CometChat-integrated chat endpoint for VIP request intake.

***

## Prerequisites

- Mastra project (`npx create-mastra@latest my-mastra-app`).
- Node.js 18+ (20+ recommended).
- OpenAI key in `.env` as `OPENAI_API_KEY`.
- (Optional) CometChat app for live deployment.

***

## Quick links

- **Project README**: `README.md`
- **Primary agent**: `src/mastra/agents/vip-request-escalation-agent.ts`
- **Specialists**: `concierge-agent.ts`, `senior-concierge-agent.ts`, `vip-manager-agent.ts`, `human-rep-agent.ts`
- **Tool**: `src/mastra/tools/vip-request-tool.ts`
- **Workflow**: `src/mastra/workflows/vip-request-workflow.ts`
- **Mastra init**: `src/mastra/index.ts`
- **Generate endpoint (local)**: `POST http://localhost:4111/api/agents/vipRequestsAgent/generate`

***

## How it works

The VIP Requests Escalation Agent:

- Parses user luxury / service request text (concierge, travel, security, bespoke experiences).
- Scores complexity, exclusivity, sensitivity, and urgency (keyword & semantic cues).
- Routes to a service tier:
  - `concierge` — standard luxury needs (restaurant, tickets, shopping)
  - `senior-concierge` — complex high-value logistics (private jet, exclusive venue, custom experience)
  - `vip-manager` — ultra-high-net-worth bespoke & scarce resources (private island, celebrity meeting)
  - `human` — critical / sensitive (medical, security, legal, family emergency)
- Outputs priority: standard | high | urgent | critical.
- Adds structured footer: `([routedTo] | priority: [priorityLevel] | escalated: yes/no)`.
- Optional workflow encapsulates classification for external orchestration.

Key components:
- Agent logic & instructions enforcing footer.
- Tool to analyze request & return recommended route & priority.
- Workflow to standardize structured output objects.

***

## Setup

<Steps>
  <Step title="Prepare project">Install deps and create <code>.env</code> with <code>OPENAI_API_KEY</code>.</Step>
  <Step title="Review agent instructions">Confirm footer format + escalation logic in <code>vip-request-escalation-agent.ts</code>.</Step>
  <Step title="Register tool & workflow">Ensure <code>vip-request-tool</code> exported & <code>vip-request-workflow</code> registered in <code>index.ts</code>.</Step>
  <Step title="Run locally">Start dev: <code>npm install && npx mastra dev</code>.</Step>
  <Step title="Test routing">Issue varied curl requests (standard → critical).</Step>
  <Step title="Integrate CometChat">Use agent ID <code>vipRequestsAgent</code> with public generate endpoint.</Step>
</Steps>

***

## Project Structure

- Runtime & Config
  - `package.json`, `tsconfig.json`, `README.md`
- Agents
  - `agents/vip-request-escalation-agent.ts` (primary)
  - `agents/concierge-agent.ts`
  - `agents/senior-concierge-agent.ts`
  - `agents/vip-manager-agent.ts`
  - `agents/human-rep-agent.ts`
- Tools
  - `tools/vip-request-tool.ts`
  - `tools/index.ts`
- Workflows
  - `workflows/vip-request-workflow.ts`
- Bootstrap
  - `mastra/index.ts`

***

## Step 1 - Define the Escalation Agent

Required behaviors:

- Name / ID: <b>`vipRequestsAgent`</b> → endpoint `/api/agents/vipRequestsAgent/generate`.
- Provide service evaluation + route + priority.
- CRITICAL for medical/security/legal emergencies (immediate human escalation).
- Include summary footer every response.
- Keep professional, discreet tone.

***

## Step 2 - Implement Routing Logic

Core logic should evaluate:

- Keywords (emergency, medical, security, legal, private island, jet, celebrity, exclusive, bespoke).
- Value & complexity indicators (multi-resource, custom builds, high exclusivity).
- Sensitivity (family emergency, legal, crisis) → escalate human.
- Output fields: `routedTo`, `priority`, `escalated`, recommended actions.

Workflow (if used) returns structured JSON; agent then formats narrative + footer.

***

## Step 3 - Run Locally

<Steps>
  <Step title="Install deps"><code>npm install</code></Step>
  <Step title="Start server"><code>npx mastra dev</code></Step>
  <Step title="Standard test">Curl restaurant request (expect concierge / standard)</Step>
  <Step title="Critical test">Curl medical/security (expect human / critical)</Step>
</Steps>

Example (standard):
```bash
curl -s -X POST http://localhost:4111/api/agents/vipRequestsAgent/generate \
  -H 'Content-Type: application/json' \
  -d '{"messages":[{"role":"user","content":"@agent Need dinner for 4 tonight near the marina"}]}'
```

Example (urgent bespoke):
```bash
curl -s -X POST http://localhost:4111/api/agents/vipRequestsAgent/generate \
  -H 'Content-Type: application/json' \
  -d '{"messages":[{"role":"user","content":"@agent Charter a private island and arrange exclusive yacht transfer"}]}'
```

Example (critical):
```bash
curl -s -X POST http://localhost:4111/api/agents/vipRequestsAgent/generate \
  -H 'Content-Type: application/json' \
  -d '{"messages":[{"role":"user","content":"@agent There is a medical emergency – immediate assistance"}]}'
```

***

## Step 4 - Deploy

- Expose: **`/api/agents/vipRequestsAgent/generate`** (HTTPS, authenticated).
- Add WAF / gateway: rate limits, IP filtering.
- Monitor logs for false escalations.

***

## Step 5 - Configure in CometChat

<Steps>
  <Step title="Open Dashboard"><a href="https://app.cometchat.com/" target="_blank" rel="noreferrer">CometChat Dashboard</a></Step>
  <Step title="Navigate">Your App → <b>AI Agents</b></Step>
  <Step title="Add agent">Provider=Mastra, Agent ID=<code>vipRequestsAgent</code>, Deployment URL=public generate endpoint</Step>
  <Step title="Enable">Save & toggle to Enabled</Step>
</Steps>

> Add additional concierge tier agents later if you expose them individually.

***

## Step 6 - Customize in Chat Builder

<Steps>
  <Step title="Select agent">Open the created AI Agent card.</Step>
  <Step title="Customize & Deploy">Adjust theme, brand voice, disclaimers.</Step>
  <Step title="Footer check">Ensure footer `( [routedTo] | priority: ... )` appears.</Step>
  <Step title="Preview">Test high-value vs emergency prompts.</Step>
</Steps>

<Frame>
  <img src="https://mintcdn.com/cometchat-22654f5b/2U5tVIzH12dbbFtr/images/ai-agent-chat-builder-preview.png?fit=max&auto=format&q=85" width="5760" height="3200" />
</Frame>

***

## Step 7 - Integrate

<CardGroup>
  <Card title="No Code - Widget" icon={<img src="/docs/images/products/ai-agents.svg" alt="Widget" />} description="Embed / script" href="/widget/ai-agents" horizontal />
  <Card title="React UI Kit" icon={<img src="/docs/images/icons/react.svg" alt="React" />} href="https://www.cometchat.com/docs/ui-kit/react/ai-assistant-chat" horizontal>Pre Built UI Components</Card>
</CardGroup>

> Your escalation agent is now accessible to VIP users in chat.

***

## Step 8 - Test Your Setup

<Steps>
  <Step title="Footer present">Each response ends with routing footer.</Step>
  <Step title="Priority mapping">Escalation changes priority accordingly.</Step>
  <Step title="Critical handling">Emergency phrases → human + critical.</Step>
  <Step title="Agent discovery">GET <code>/api/agents</code> lists <code>vipRequestsAgent</code>.</Step>
</Steps>

Additional curl – mixed complexity:
```bash
curl -s -X POST http://localhost:4111/api/agents/vipRequestsAgent/generate \
  -H 'Content-Type: application/json' \
  -d '{"messages":[{"role":"user","content":"@agent Arrange a private jet to Milan, couture fitting, and next-day art gallery private tour"}]}'
```

***

## Security & Production Checklist

- Auth: API key / JWT for generate endpoint.
- CORS: Restrict to trusted frontends.
- Rate limiting: Prevent enumeration / abuse (concierge capacity safeguarding).
- Logging: Structured logs with requestId (exclude PII beyond necessary context).
- Data retention: Purge sensitive request transcripts as policy requires.
- Escalation audit trail: Persist routing decisions & timestamps.
- Abuse detection: Flag repeated high-tier luxury patterns without verification.

***

## Troubleshooting

- **Always standard routing**: Expand keyword sets in tool logic; add semantic checks.
- **Missing footer**: Re-check agent instructions not altered downstream.
- **False critical escalations**: Tune emergency keyword weighting / add negative filters.
- **Agent not found**: Confirm registration key matches endpoint path (`vipRequestsAgent`).
- **Slow responses**: Review model choice & reduce excessive context tokens.

***

## Environment Variables

```bash .env
OPENAI_API_KEY=""          # Required OpenAI key
PORT=4111                   # Server port (if using built-in server)
VIP_LOG_LEVEL=info          # Optional logging verbosity
```

***

## Extension Ideas

- Add cost estimation module for resource requests.
- Integrate provider APIs (private jet brokers, hospitality inventory).
- Multi-step workflow: intake → classify → verify client tier → confirm / escalate.
- Real-time SLA monitoring dashboard.
- Sensitive topic redaction (PII masking before persistence).

***

## Sample Response Footer

```
Concierge recommendations prepared. I can proceed with booking windows now.
(concierge | priority: standard | escalated: no)
```

***

## Summary

You now have a Mastra-powered VIP Requests Escalation & Human Handoff Agent that classifies luxury service intents, prioritizes urgency, supports human intervention, and integrates seamlessly with CometChat.
