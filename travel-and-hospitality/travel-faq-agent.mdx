# Build Your Travel FAQ Retrieval Agent with Mastra

> Create a Mastra agent that answers traveler questions about baggage, check‑in, cancellations, and general policies from a maintained markdown knowledge base — then connect it to CometChat.

***

## What You’ll Build

- **Mastra retrieval agent** (`travel-faq`) providing authoritative travel policy answers.
- Document search tool (`docsRetriever`) over a markdown knowledge base.
- Responses with mandatory disclaimers + cited sources.
- Single generate endpoint for chat + CometChat integration.

***

## Prerequisites

- Mastra project (`npx create-mastra@latest my-mastra-app`).
- Node.js 18+ (20+ recommended).
- OpenAI key in `.env` as `OPENAI_API_KEY`.
- CometChat app for AI Agent integration.

***

## Quick links

- **Project README**: `README.md`
- **Agent**: `src/mastra/agents/travel-faq-agent.ts`
- **Tool**: `src/mastra/tools/docs-retriever.ts`
- **Knowledge base**: `knowledge/travel/`
- **Endpoint (local)**: `POST http://localhost:4111/api/agents/travel-faq/generate`

***

## How it works

The Travel FAQ Agent:

- Receives a user question (baggage, check‑in, cancellations, general travel).
- Always invokes the `docsRetriever` tool first with namespace `travel`; falls back to `default` if empty.
- Ranks & extracts relevant sections from markdown docs.
- Constructs a concise answer in traveler‑friendly language.
- Appends standardized disclaimer + file basenames as sources.
- For urgent scenarios (cancellations, lost baggage, medical, missed connections) instructs immediate airline contact.

Key components:
- Agent registration: `src/mastra/agents/travel-faq-agent.ts`
- Retrieval tool: `src/mastra/tools/docs-retriever.ts`
- Knowledge docs: `knowledge/travel/*.md`
- Mastra bootstrap: `src/mastra/index.ts`

***

## Setup

<Steps>
  <Step title="Prepare project">Install dependencies and add <code>OPENAI_API_KEY</code> in <code>.env</code>.</Step>
  <Step title="Add knowledge docs">Place or edit markdown files in <code>knowledge/travel/</code> (baggage, check-in, cancellations, general).</Step>
  <Step title="Define agent">Ensure agent name <b>"travel-faq"</b> with instructions enforcing: tool-first retrieval, disclaimers, source listing.</Step>
  <Step title="Register tool">Export <code>docsRetriever</code> in <code>tools/index.ts</code> and attach to the agent.</Step>
  <Step title="Run locally">Start dev server (<code>npm run dev</code> or <code>npx mastra dev</code>).</Step>
  <Step title="Query the agent">POST to <code>/api/agents/travel-faq/generate</code> with a messages array.</Step>
  <Step title="Connect CometChat">Configure AI Agent (Provider=Mastra, ID=<code>travel-faq</code>, Deployment URL public generate endpoint).</Step>
</Steps>

***

## Project Structure

- Knowledge Base
  - `knowledge/travel/baggage-policies-guide.md`
  - `knowledge/travel/check-in-procedures-guide.md`
  - `knowledge/travel/cancellations-rebooking-guide.md`
  - `knowledge/travel/general-travel-faq.md`
- Agent & Tools
  - `src/mastra/agents/travel-faq-agent.ts`
  - `src/mastra/tools/docs-retriever.ts`
  - `src/mastra/tools/index.ts`
- Runtime
  - `src/mastra/index.ts`
  - `package.json`, `tsconfig.json`, `README.md`

***

## Step 1 - Create the Agent

Configure the agent with:

- `name`: <b>travel-faq</b> → endpoint `/api/agents/travel-faq/*`.
- Mandatory retrieval sequence: call `docsRetriever` before crafting answer.
- Instruction footer: always include disclaimer + `Sources: [file1, file2]`.
- Tool map: `{ docsRetriever }`.

***

## Step 2 - Curate the Knowledge Base

Guidelines:
- Use focused markdown guides (one domain per file).
- Add clear headings & bullet lists for scannability.
- Keep airline-specific nuances labeled (e.g., "Some carriers may...").
- Update timestamps when policies change.
- Avoid personally identifiable or booking-specific data.

Adding new topic:
1. Create `knowledge/travel/<topic>-guide.md`.
2. Add structured sections.
3. Restart or hot-reload agent if needed.
4. Test a representative question.

***

## Step 3 - Run & Query

<Steps>
  <Step title="Install"> <code>npm install</code> </Step>
  <Step title="Dev server"> <code>npm run dev</code> (expected base: <code>http://localhost:4111/api</code>) </Step>
  <Step title="Ask a question"> POST <code>/api/agents/travel-faq/generate</code> with user message. </Step>
</Steps>

Example curl – baggage:
```bash
curl -X POST http://localhost:4111/api/agents/travel-faq/generate \
  -H 'Content-Type: application/json' \
  -d '{"messages":[{"role":"user","content":"What are international checked baggage weight limits?"}]}'
```

Example curl – cancellation:
```bash
curl -X POST http://localhost:4111/api/agents/travel-faq/generate \
  -H 'Content-Type: application/json' \
  -d '{"messages":[{"role":"user","content":"My flight was cancelled—what should I do?"}]}'
```

***

## Step 4 - Deploy

- Expose `/api/agents/travel-faq/generate` via HTTPS.
- Add reverse proxy / gateway (rate limits + auth headers if needed).
- Monitor latency & token usage.

***

## Step 5 - Configure in CometChat

<Steps>
  <Step title="Open Dashboard"><a href="https://app.cometchat.com/" target="_blank" rel="noreferrer">CometChat Dashboard</a></Step>
  <Step title="AI Agents">Select your app → <b>AI Agents</b>.</Step>
  <Step title="Add agent">Provider=Mastra; Agent ID=<code>travel-faq</code>; Deployment URL=public generate endpoint.</Step>
  <Step title="Enable">Save & verify status toggle is <b>Enabled</b>.</Step>
</Steps>

***

## Step 6 - Customize in Chat Builder

<Steps>
  <Step title="Open variant">Select the Travel FAQ agent entry.</Step>
  <Step title="Customize & Deploy">Choose appearance, behavior, localization.</Step>
  <Step title="Attach agent">Ensure <code>travel-faq</code> is the active AI agent.</Step>
  <Step title="Preview">Validate disclaimers + source list appear.</Step>
</Steps>

<Frame>
  <img src="https://mintcdn.com/cometchat-22654f5b/2U5tVIzH12dbbFtr/images/ai-agent-chat-builder-preview.png?fit=max&auto=format&q=85" width="5760" height="3200" />
</Frame>

***

## Step 7 - Integrate

<CardGroup>
  <Card title="No Code - Widget" icon={<img src="/docs/images/products/ai-agents.svg" alt="Widget" />} description="Embed / script" href="/widget/ai-agents" horizontal />
  <Card title="React UI Kit" icon={<img src="/docs/images/icons/react.svg" alt="React" />} href="https://www.cometchat.com/docs/ui-kit/react/ai-assistant-chat" horizontal>Pre Built UI Components</Card>
</CardGroup>

> Once connected, travelers can ask policy questions instantly 24/7.

***

## Step 8 - Test Your Setup

<Steps>
  <Step title="Endpoint works">POST returns answer + disclaimer + Sources list.</Step>
  <Step title="Agent listed">GET <code>/api/agents</code> includes <code>"travel-faq"</code>.</Step>
  <Step title="Source coverage">Different queries cite appropriate files.</Step>
  <Step title="Fallback">Unmatched queries still advise airline contact.</Step>
</Steps>

***

## Security & Production Checklist

- Add auth (API key / JWT) to public endpoint.
- Restrict CORS to trusted domains.
- Rate limit & set body size limits.
- Sanitize logs (no sensitive PNR or passenger data).
- Version documents; include change logs for policy updates.
- Monitor token + latency metrics; cache frequent Q&A if stable.

***

## Troubleshooting

- **Empty Sources**: Confirm docs in `knowledge/travel/` and readable at runtime.
- **No disclaimer**: Ensure agent instructions not modified removing required text.
- **Irrelevant answer**: Improve headings & specificity inside docs.
- **Tool not invoked**: Verify `docsRetriever` is in agent tools map.
- **Low recall**: Split overly long documents or add clearer section headers.

***

## Environment Variables

```bash .env
OPENAI_API_KEY=""          # Required: OpenAI key
PORT=4111                   # Server port
```

***

## Customization Ideas

- Add multi-language variants (duplicate docs per locale).
- Introduce vector embeddings for semantic retrieval (hybrid search).
- Add urgency classifier → escalate to live support for critical cases.
- Implement doc freshness scoring; prefer most recently updated policies.
- Add analytics tool (top unanswered queries → doc gaps).

***

## Sample Answer Pattern

```
Carry-on items typically include small electronics, essential medications, and baby supplies within liquid limits. Oversized or restricted items must be checked or declared.

This information is based on general airline policies and may vary by carrier, route, and specific circumstances. Contact your airline directly for the most current information.

Sources: baggage-policies-guide.md
```

***

## Summary

You now have a Mastra Travel FAQ Agent that retrieves curated policy content, applies disclaimers, cites sources, and is ready for CometChat deployment.
